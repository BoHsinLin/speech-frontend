<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Speech Translator</title>
</head>
<body>
  <h2>ğŸ™ è‹±æ–‡ â†’ ä¸­æ–‡ å³æ™‚ç¿»è­¯</h2>

  <button id="start">é–‹å§‹éŒ„éŸ³</button>
  <button id="stop" disabled>åœæ­¢</button>

  <h3>è‹±æ–‡</h3>
  <pre id="en"></pre>

  <h3>ä¸­æ–‡</h3>
  <pre id="zh"></pre>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      let recorder;
      let chunks = [];
    
      const startBtn = document.getElementById("start");
      const stopBtn  = document.getElementById("stop");
    
      startBtn.onclick = async () => {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        recorder = new MediaRecorder(stream);
        chunks = [];
    
        recorder.ondataavailable = e => chunks.push(e.data);
        recorder.start();
    
        startBtn.disabled = true;
        stopBtn.disabled = false;
      };
    
      stopBtn.onclick = () => {
        recorder.stop();
        startBtn.disabled = false;
        stopBtn.disabled = true;
    
        recorder.onstop = async () => {
          const blob = new Blob(chunks, { type: "audio/webm" });
          const file = new File([blob], "audio.webm");
    
          const form = new FormData();
          form.append("file", file);
    
          const res = await fetch("https://ä½ çš„-cloud-run-URL/speech", {
            method: "POST",
            body: form
          });
    
          const data = await res.json();
          document.getElementById("en").textContent = data.en;
          document.getElementById("zh").textContent = data.zh;
        };
      };
    });
    </script>
</body>
</html>
